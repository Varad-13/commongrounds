{% extends 'core/base.html' %}
{% load static %}

{% block title %}Chat{% endblock %}
{% block page_title %}{{ chat.title }}{% endblock %}
{% block content %}
<div id="message-box" class="h-full flex-shrink px-4 sm:ml-64 flex-col justify-end overflow-y-auto">
    <!-- Message Area -->
    <div id="message-area" class="message-area mb-4 w-full">
      <div 
          id="inner-message" 
          class="flex flex-col gap-2.5 w-full"
          >
          {% for message in chat.messages.all %}
              {% include 'chat/partials/message.html' %}
          {% endfor %}
      </div>
    </div>
 </div>

 <div class="flex-1 p-4 sm:ml-64 border-t border-gray-300 dark:border-gray-700">
   <!-- Chat Box -->
   <div class="inline-flex w-full gap-4">
      <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
      <input hx-post="{% url 'send_message' chat.id %}" 
             hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}' 
             hx-target="#inner-message" 
             hx-swap="beforeend" 
             type="text" id="chat-input" 
             name="content" 
             class="block p-2.5 w-full flex flex-wrap text-sm text-gray-900 bg-gray-50 h-auto rounded border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:border-blue-500" 
             placeholder="Type a message..."
             >
      <button hx-post="{% url 'send_message' chat.id %}" 
              hx-trigger="click" 
              hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}' 
              hx-target="#inner-message" 
              hx-swap="beforeend"
              class="px-5 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
              >
         <span class="material-symbols-outlined">send</span>
      </button>
   </div>
 </div>
 <script>
   document.addEventListener('htmx:afterSwap', function(event) {
      if (event.detail.pathInfo.path === "/chat/{{chat.id}}/send/") {
        document.getElementById('chat-input').value = '';
        const chat = document.getElementById('message-box');
         chat.scrollTo({
         top: chat.scrollHeight,
         behavior: 'smooth'
         });
      }
   });
   window.onload = function() {
      const chat = document.getElementById('message-box');
      chat.scrollTop = chat.scrollHeight
   };
</script>
{% endblock %}
